var QuickSearch={minimum_length:3,search_delay:125,cache:{},init:function(){$("#search_query").bind("keydown",QuickSearch.on_keydown),$("#search_query").bind("keyup",QuickSearch.on_keyup),$("#search_query").bind("change",QuickSearch.on_change),$("#search_query").blur(QuickSearch.on_blur),$("#search_query").attr("autocomplete","off")},on_blur:function(){QuickSearch.item_selected||QuickSearch.over_all||QuickSearch.hide_popup()},on_keydown:function(e){if(13!=e.keyCode||e.altKey){if(27==e.keyCode){if(document.getElementById("QuickSearch"))try{e.preventDefault(),e.stopPropagation()}catch(c){}QuickSearch.hide_popup()}}else{if(QuickSearch.selected){try{e.preventDefault(),e.stopPropagation()}catch(c){}return window.location=QuickSearch.selected.url,!1}QuickSearch.hide_popup()}},on_keyup:function(e){if(QuickSearch.timeout&&clearTimeout(QuickSearch.timeout),40==e.keyCode&&QuickSearch.results){QuickSearch.selected&&QuickSearch.results.length>=QuickSearch.selected.index+1&&QuickSearch.highlight_item(QuickSearch.selected.index+1,!0),!QuickSearch.selected&&QuickSearch.results.length>0&&QuickSearch.highlight_item(0,!0);try{e.preventDefault(),e.stopPropagation()}catch(c){}return!1}if(38==e.keyCode&&QuickSearch.results){QuickSearch.selected&&QuickSearch.selected.index>0&&QuickSearch.highlight_item(QuickSearch.selected.index-1,!0);try{e.preventDefault(),e.stopPropagation()}catch(c){}}else if(27==e.keyCode)QuickSearch.hide_popup();else{if($("#search_query").val()==QuickSearch.last_query)return!1;QuickSearch.selected=!1,$("#search_query").val().replace(/^\s+|\s+$/g,"").length>=QuickSearch.minimum_length?(QuickSearch.last_query=$("#search_query").val().replace(/^\s+|\s+$/g,""),QuickSearch.timeout&&window.clearTimeout(QuickSearch.timeout),QuickSearch.timeout=window.setTimeout(QuickSearch.do_search,QuickSearch.search_delay)):document.getElementById("QuickSearch")&&$("#QuickSearch").remove()}},on_change:function(e){return QuickSearch.on_keydown(e)&&QuickSearch.on_keyup(e)},do_search:function(){var e=$("#search_query").val().length+$("#search_query").val();QuickSearch.cache[e]?QuickSearch.search_done(QuickSearch.cache[e]):$.ajax({type:"GET",dataType:"xml",url:"/search.php?action=AjaxSearch&search_query="+encodeURIComponent($("#search_query").val()),success:function(e){QuickSearch.search_done(e)}})},search_done:function(e){var c=$("#search_query").val().length+$("#search_query").val();if(QuickSearch.cache[c]=e,document.getElementById("QuickSearch")&&$("#QuickSearch").remove(),$("result",e).length>0){var r=document.createElement("TABLE");r.className="QuickSearch",r.id="QuickSearch";var a=document.createElement("TBODY");r.appendChild(a);var i=0;$("result",e).each(function(){var e=$($(this).text()),c=$(".QuickSearchResultName a",e).attr("href"),r=i;$(e).attr("id","QuickSearchResult"+r),$(e).bind("mouseover",function(){QuickSearch.item_selected=!0,QuickSearch.highlight_item(r,!1)}),$(e).bind("mouseup",function(){window.location=c}),$(e).bind("mouseout",function(){QuickSearch.item_selected=!1,QuickSearch.unhighlight_item(r)}),$(a).append(e),i++});var u=$("viewmoreurl",e).size();if(u){var t=document.createElement("TR"),h=document.createElement("TD");t.className="QuickSearchAllResults",t.onmouseover=function(){QuickSearch.over_all=!0},t.onmouseout=function(){QuickSearch.over_all=!1},h.colSpan=2,h.innerHTML=$("viewmoreurl",e).text(),t.appendChild(h),a.appendChild(t)}$("#QuickSearch")&&$("#QuickSearch").remove(),$("#SearchForm").append(r),$(r).show()}else document.getElementById("QuickSearch")&&$("#QuickSearch").remove()},hide_popup:function(){$("#QuickSearch").remove(),QuickSearch.selected=null},highlight_item:function(e,c){element=$("#QuickSearchResult"+e),1==c&&(QuickSearch.selected&&(QuickSearch.selected.className="QuickSearchResult"),QuickSearch.selected=document.getElementById("QuickSearchResult"+e)),element.addClass("QuickSearchHover")},unhighlight_item:function(e){element=$("#QuickSearchResult"+e),element.removeClass("QuickSearchHover")}};$(document).ready(function(){QuickSearch.init()});